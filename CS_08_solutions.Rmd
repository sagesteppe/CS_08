---
title: "CS_08"
author: "steppe"
date: "2/28/2022"
output:
  pdf_document: default
  html_document: default
---

This is a case study !
  
Many solutions are available!

'You can go your own way, go your own way!'

We made you panic and sweat!


```{r Load Library}
library(kableExtra)
library(tidyverse)
```

```{r View Data}
data(iris)
head(iris)
```

```{r Create Iris Summary Statistics}

a <- iris %>% 
  split(.$Species) %>% 
  map(summary) %>% 
  map(as.data.frame) %>% 
  map(drop_na) %>% 
  bind_rows() %>% 
  separate(Freq, c('Statistic', 'Value'), ":") %>% 
  filter(!str_detect(Var2, 'Species')) %>% 
  mutate(Species = c(rep('setosa', times = 24), 
                     rep('versicolor', times = 24), 
                     rep('virginica', times = 24))) %>% 
  select(-Var1) %>% 
  rename(Variable = Var2) %>% 
  filter(!str_detect(Statistic, 'Qu'))

iris_table <- iris %>% 
  group_by(Species) %>% 
  summarise(across(everything(), list('min.' = min,
                         max = max, 
                         mean = mean,
                         median = median))) %>% 
  pivot_longer(-Species, values_to = 'Value') %>% 
  separate(name, c('Tissue', 'Statistic'), sep = "_") %>% 
  
  # style down here
  mutate(Tissue = str_replace(Tissue, '[.]', ' ')) %>% 
  mutate(Species =  paste0('I. ', Species)) %>% 
  mutate(Value = round(Value, digits = 1)) %>% 
  
  pivot_wider(names_from = Tissue, values_from = Value) %>% 
  mutate(Statistic=fct_relevel(Statistic, "min.", "mean", "median", 'max')) %>% 
  arrange(Species, Statistic)

iris_table[c(2:4, 6:8, 10:12),1] <- ""
knitr::kable(iris_table, 
             align = "llcccc", 
             col.names = c('Species','Statistic','Length','Width','Length','Width'), 
             caption = "Summary Statistics of Iris Dataset") %>% 
  kable_classic(full_width = F, html_font = "Cambria") %>% 
  add_header_above(., c(" " = 2, "Sepal" = 2, "Petal" = 2))  

rm(a, iris_table)
```



```{r Create Model of Single Continuous Predictor and Response}
model_summary <- summary(lm(Sepal.Length ~ Sepal.Width, data = iris))
model_summary_statistics <- tibble("intercept" = model_summary$coefficients[1,1],
                                   "slope"     = model_summary$coefficients[2,1],
                                   "p_value"   = model_summary$coefficients[2,4],
                                   "r_squared"  = model_summary$r.squared)    
model_summary_statistics
model_summary_statistics %>% 
  mutate(across(where(is.numeric), ~ round(.x, digits = 3))) %>% 
  knitr::kable( 
             col.names = c('Intercept', 'Slope','p-Value','R$^2$'),
             align = "cccc",
             caption = "Results of a linear model with one continuous predictor and response"
             ) %>% 
  kable_classic(full_width = F, html_font = "Cambria")

rm(model_summary_statistics)
```


```{r Plot relationship between single continuous predictor and response}

ggplot(iris, aes(x = Sepal.Width, y = Sepal.Length))+
  geom_jitter()+
  geom_abline(intercept = model_summary$coefficients[1,1], 
              slope = model_summary$coefficients[2,1], size = 2) +
  theme_classic(base_size = 10) +
  labs(title = 'Relationship between Sepal Width and Sepal Length in three Species of Iris',
       y = 'Sepal Length', x = 'Sepal Width') +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r Plot relationship between single continuous predictor and response with a confidence interval}
model <- lm(Sepal.Length ~ Sepal.Width, data = iris)
conf_int <- as.data.frame(predict(model, interval = "confidence"))
data <- cbind(conf_int, iris)

ggplot(data, aes(x = Sepal.Width, y = Sepal.Length))+
  geom_jitter()+
  geom_abline(intercept = model_summary$coefficients[1,1], 
              slope = model_summary$coefficients[2,1], size = 2) +
  theme_classic(base_size = 10)+ 
  geom_line(aes(y = lwr), color = "black", linetype = "dashed") +
  geom_line(aes(y = upr), color = "black", linetype = "dashed") +
  geom_ribbon(aes(ymin=lwr, ymax=upr), alpha=0.1) +
  labs(title = 'Relationship between Sepal Width and Sepal Length in three Iris Species',
       y = 'Sepal Length', x = 'Sepal Width') +
  theme(plot.title = element_text(hjust = 0.5))

rm(model, conf_int, data)
```


```{r Plot relationship between single continuous predictor and response with a confidence interval -Compare results}
ggplot(data, aes(x = Sepal.Width, y = Sepal.Length))+
  geom_jitter()+
  geom_smooth(method = "lm", colour = "black", formula = y ~ x) +
  labs(title = 'Relationship between Sepal Width and Sepal Length in three Iris Species',
       y = 'Sepal Length', x = 'Sepal Width') +
  theme_classic(base_size = 10) +
  theme(plot.title = element_text(hjust = 0.5))
```


```{r Clear environment}
rm(iris, model_summary)
```

